<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>أسئلة الكتاب المقدس ✝️</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.0/firebase-app.js";
    import { getDatabase, ref, push, onValue, query, limitToLast, orderByChild, update, set } from "https://www.gstatic.com/firebasejs/9.6.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA0fXyDKAC3JrtwMwHR1F15LrM4DwK8Flg",
      authDomain: "abram-8f35b.firebaseapp.com",
      databaseURL: "https://abram-8f35b-default-rtdb.firebaseio.com",
      projectId: "abram-8f35b",
      storageBucket: "abram-8f35b.appspot.com",
      messagingSenderId: "432922833796",
      appId: "1:432922833796:web:c5c22f855b08895565e3d1"
    };

    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    
    window.firebaseDatabase = database;
    window.firebaseRef = ref;
    window.firebasePush = push;
    window.firebaseOnValue = onValue;
    window.firebaseQuery = query;
    window.firebaseLimitToLast = limitToLast;
    window.firebaseOrderByChild = orderByChild;
    window.firebaseUpdate = update;
    window.firebaseSet = set;
  </script>
  
  <style>
    body {
      background-color: #0a0a1a;
      color: #ffffff;
      font-family: 'Arial', sans-serif;
      text-align: center;
      padding: 20px;
      margin: 0;
      overflow-x: hidden;
      position: relative;
      min-height: 100vh;
    }
    .cross {
      position: absolute;
      color: rgba(76, 201, 240, 0.3);
      font-size: 30px;
      animation: float 8s linear infinite;
      z-index: -1;
      pointer-events: none;
    }
    @keyframes float {
      0% { transform: translateY(100vh) translateX(0) rotate(0deg); opacity: 0; }
      20% { opacity: 0.3; }
      80% { opacity: 0.3; }
      100% { transform: translateY(-100px) translateX(100px) rotate(360deg); opacity: 0; }
    }
    .developer-card {
      position: fixed;
      bottom: 15px;
      left: 15px;
      background: rgba(10, 10, 30, 0.8);
      border: 1px solid #4cc9f0;
      border-radius: 12px;
      padding: 10px 12px;
      box-shadow: 0 0 10px rgba(76, 201, 240, 0.3);
      z-index: 100;
      direction: ltr;
      text-align: left;
      backdrop-filter: blur(5px);
      transition: all 0.3s ease;
      font-size: 14px;
    }
    .developer-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 0 15px rgba(76, 201, 240, 0.5);
    }
    .dev-title {
      font-size: 12px;
      color: #4cc9f0;
      margin-bottom: 2px;
      font-weight: bold;
    }
    .dev-name {
      font-size: 15px;
      color: white;
      margin-bottom: 5px;
      font-weight: bold;
    }
    .contact-container {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .whatsapp-btn {
      display: flex;
      align-items: center;
      gap: 4px;
      background: #25D366;
      color: white;
      padding: 4px 8px;
      border-radius: 15px;
      text-decoration: none;
      font-size: 12px;
      transition: all 0.3s;
    }
    .whatsapp-btn:hover {
      background: #128C7E;
      transform: scale(1.05);
    }
    .whatsapp-icon {
      width: 14px;
      height: 14px;
      filter: drop-shadow(0 0 2px rgba(255, 255, 255, 0.5));
    }
    .phone-number {
      font-family: 'Courier New', monospace;
      font-size: 13px;
      color: white;
      direction: ltr;
      display: inline-block;
      margin-left: 3px;
    }
    .question, .result, #start-screen {
      margin: 20px auto;
      max-width: 800px;
      background-color: rgba(10, 10, 30, 0.7);
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
    }
    .answers {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-top: 20px;
    }
    .answers button {
      background-color: #16213e;
      color: white;
      border: 1px solid #4cc9f0;
      padding: 12px 20px;
      cursor: pointer;
      border-radius: 8px;
      font-size: 16px;
      transition: all 0.3s;
      min-width: 120px;
    }
    .answers button:hover {
      background-color: #4cc9f0;
      color: #16213e;
    }
    input {
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #4cc9f0;
      font-size: 16px;
      margin: 10px;
      background-color: #16213e;
      color: white;
      width: 250px;
    }
    button#start-button {
      background-color: #4CAF50;
      color: white;
      padding: 15px 30px;
      font-size: 18px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 20px;
    }
    h1 {
      color: #4cc9f0;
      font-size: 28px;
      margin-bottom: 15px;
    }
    h2 {
      font-size: 22px;
      margin-bottom: 15px;
      color: #ffffff;
    }
    .bible-verse {
      font-style: italic;
      color: #4cc9f0;
      margin-top: 15px;
      font-size: 16px;
    }
    .hidden {
      display: none;
    }
    .main-leaderboard {
      margin: 30px auto;
      max-width: 800px;
      background-color: rgba(10, 10, 30, 0.7);
      padding: 15px;
      border-radius: 15px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
    }
    .main-leaderboard h3 {
      color: #4cc9f0;
      margin: 0 0 15px 0;
      font-size: 20px;
      text-align: center;
      border-bottom: 1px solid #4cc9f0;
      padding-bottom: 8px;
    }
    .player-score {
      display: flex;
      justify-content: space-between;
      padding: 8px 10px;
      border-bottom: 1px solid rgba(76, 201, 240, 0.2);
      font-size: 16px;
      transition: all 0.3s;
    }
    .player-score:hover {
      background: rgba(76, 201, 240, 0.1);
    }
    .player-score:last-child {
      border-bottom: none;
    }
    .player-name {
      color: white;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 60%;
    }
    .player-points {
      color: #4cc9f0;
      font-weight: bold;
      margin-left: 10px;
    }
    .rank-1 {
      background: rgba(255, 215, 0, 0.15);
      border-right: 3px solid gold;
    }
    .rank-2 {
      background: rgba(192, 192, 192, 0.15);
      border-right: 3px solid silver;
    }
    .rank-3 {
      background: rgba(205, 127, 50, 0.15);
      border-right: 3px solid #cd7f32;
    }
    .no-scores {
      text-align: center;
      color: #aaa;
      padding: 20px;
      font-size: 16px;
    }
    .wrong-answers-section {
      margin-top: 30px;
      text-align: right;
      background: rgba(255, 0, 0, 0.1);
      padding: 15px;
      border-radius: 10px;
      border-right: 3px solid #ff4d4d;
    }
    .wrong-answers-title {
      color: #ff4d4d;
      font-size: 18px;
      margin-bottom: 10px;
    }
    .wrong-answer-item {
      margin-bottom: 10px;
      padding: 10px;
      background: rgba(255, 77, 77, 0.1);
      border-radius: 5px;
    }
    .question-text {
      font-weight: bold;
      margin-bottom: 5px;
    }
    .your-answer {
      color: #ff4d4d;
    }
    .correct-answer {
      color: #4cc9f0;
    }
    .show-answers-btn {
      background: #ff4d4d;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 10px;
      transition: all 0.3s;
    }
    .show-answers-btn:hover {
      background: #ff3333;
    }
    .leaderboard-container {
      max-height: 300px;
      overflow-y: auto;
      margin-top: 15px;
      border: 1px solid #4cc9f0;
      border-radius: 8px;
      padding: 10px;
    }
    .leaderboard-header {
      display: flex;
      justify-content: space-between;
      padding: 8px;
      font-weight: bold;
      border-bottom: 1px solid #4cc9f0;
    }
    .leaderboard-row {
      display: flex;
      justify-content: space-between;
      padding: 8px;
      border-bottom: 1px solid rgba(76, 201, 240, 0.2);
    }
    .leaderboard-row:last-child {
      border-bottom: none;
    }
    .rank {
      width: 30px;
      text-align: center;
    }
    .name {
      flex: 1;
      text-align: right;
      padding-right: 15px;
    }
    .score {
      width: 60px;
      text-align: center;
    }
    .date {
      width: 100px;
      text-align: left;
      font-size: 12px;
      color: #aaa;
    }
    .leaderboard-container::-webkit-scrollbar {
      width: 5px;
    }
    .leaderboard-container::-webkit-scrollbar-track {
      background: #0a0a1a;
    }
    .leaderboard-container::-webkit-scrollbar-thumb {
      background: #4cc9f0;
      border-radius: 5px;
    }
    #name-error {
      color: #ff4444;
      display: none;
      margin-top: 5px;
    }
    .timer-container {
      margin: 15px 0;
      font-size: 18px;
      color: #4cc9f0;
    }
    .timer {
      font-weight: bold;
      font-size: 20px;
    }
    .timeout-message {
      color: #ff4d4d;
      font-size: 20px;
      margin: 20px 0;
    }
  </style>
</head>
<body>
  <div id="crosses-container"></div>
 
  <div class="developer-card">
    <div class="dev-title">Developer</div>
    <div class="dev-name">Abram</div>
    <div class="contact-container">
      <a href="https://wa.me/201204625935" target="_blank" class="whatsapp-btn">
        <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" class="whatsapp-icon" alt="WhatsApp">
        Chat
      </a>
      <span class="phone-number">+201204625935</span>
    </div>
  </div>

  <div id="start-screen">
    <h1>مرحبًا بكم في أسئلة الكتاب المقدس ✝️</h1>
    <p>اختبر معرفتك بالكتاب المقدس</p>
    <input type="text" id="player-name" placeholder="اكتب اسمك هنا" required />
    <div id="name-error">الاسم يجب أن يكون بالعربية أو الإنجليزية فقط (بدون أرقام أو رموز)</div>
    <br />
    <button id="start-button" onclick="validateName()">ابدأ اللعبة</button>
   
    <div class="main-leaderboard" id="main-leaderboard">
      <h3>أفضل اللاعبين</h3>
      <div id="leaderboard-content" class="leaderboard-container">
        <div class="leaderboard-header">
          <span class="rank">#</span>
          <span class="name">الاسم</span>
          <span class="score">النقاط</span>
          <span class="date">التاريخ</span>
        </div>
      </div>
    </div>
  </div>

  <div id="question-container" class="hidden"></div>

  <div id="result" class="result hidden"></div>

  <audio id="win-sound" src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" preload="auto"></audio>

  <script>
    let players = [];
    let wrongAnswers = [];
    let currentQuestion = 0;
    let score = 0;
    let playerName = '';
    let timer;
    let timeLeft = 15;

    document.addEventListener('DOMContentLoaded', function() {
      if (!window.firebaseDatabase) {
        const checkFirebase = setInterval(() => {
          if (window.firebaseDatabase) {
            clearInterval(checkFirebase);
            initApp();
          }
        }, 100);
      } else {
        initApp();
      }
    });

    function initApp() {
      createCrosses();
      fetchPlayers();
      
      const playerNameInput = document.getElementById('player-name');
      playerNameInput.addEventListener('focus', function() {
        window.scrollTo(0, 0);
        document.body.scrollTop = 0;
      });
    }

    function createCrosses() {
      const container = document.getElementById('crosses-container');
      const crossCount = 30;
     
      for (let i = 0; i < crossCount; i++) {
        const cross = document.createElement('div');
        cross.className = 'cross';
        cross.innerHTML = '✝';
        cross.style.left = Math.random() * 100 + 'vw';
        cross.style.top = Math.random() * 100 + 'vh';
        cross.style.animationDuration = 5 + Math.random() * 10 + 's';
        cross.style.animationDelay = Math.random() * 5 + 's';
        cross.style.fontSize = 20 + Math.random() * 30 + 'px';
        container.appendChild(cross);
      }
    }

    function fetchPlayers() {
      const playersRef = window.firebaseRef(window.firebaseDatabase, 'players');
      const playersQuery = window.firebaseQuery(
        playersRef,
        window.firebaseOrderByChild('score')
      );
      
      window.firebaseOnValue(playersQuery, (snapshot) => {
        players = [];
        snapshot.forEach((childSnapshot) => {
          const player = childSnapshot.val();
          player.id = childSnapshot.key;
          players.push(player);
        });
        
        players.sort((a, b) => {
          if (b.score !== a.score) {
            return b.score - a.score;
          }
          return new Date(a.date) - new Date(b.date);
        });
        
        updateLeaderboard();
      });
    }

    function validateName() {
      const nameInput = document.getElementById('player-name');
      const errorDiv = document.getElementById('name-error');
      const name = nameInput.value.trim();
      
      const validNameRegex = /^[\u0600-\u06FFa-zA-Z\s]+$/;
      
      if (!name) {
        errorDiv.textContent = "يجب كتابة اسم";
        errorDiv.style.display = "block";
        return;
      }
      
      if (!validNameRegex.test(name)) {
        errorDiv.style.display = "block";
        return;
      }
      
      errorDiv.style.display = "none";
      startGame();
    }

    function startGame() {
      playerName = document.getElementById('player-name').value.trim();
     
      document.getElementById('main-leaderboard').classList.add('hidden');
      document.getElementById('start-screen').classList.add('hidden');
      document.getElementById('question-container').classList.remove('hidden');
      showQuestion();
    }

    function startTimer() {
      clearInterval(timer);
      timeLeft = 15;
      updateTimerDisplay();
      
      timer = setInterval(() => {
        timeLeft--;
        updateTimerDisplay();
        
        if (timeLeft <= 0) {
          clearInterval(timer);
          timeOut();
        }
      }, 1000);
    }

    function updateTimerDisplay() {
      const timerElement = document.getElementById('timer');
      if (timerElement) {
        timerElement.textContent = timeLeft;
        
        if (timeLeft <= 5) {
          timerElement.style.color = '#ff4d4d';
        } else {
          timerElement.style.color = '#4cc9f0';
        }
      }
    }

    function timeOut() {
      const container = document.getElementById('question-container');
      container.innerHTML = `
        <div class="timeout-message">
          <h2>انتهى الوقت!</h2>
          <p>لم تقم بالإجابة على السؤال في الوقت المحدد</p>
          <button onclick="nextQuestionAfterTimeout()" style="background-color: #4cc9f0; color: #16213e; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; margin-top: 20px;">
            التالي
          </button>
        </div>
      `;
      
      const currentQ = questions[currentQuestion];
      wrongAnswers.push({
        question: currentQ.text(),
        yourAnswer: 'لم يتم الإجابة',
        correctAnswer: currentQ.correct
      });
    }

    function nextQuestionAfterTimeout() {
      currentQuestion++;
      showQuestion();
    }

    const questions = [
      {
        text: () => 'من أين يخرج قضاء داود حسب المزمور؟',
        options: ['من أفواه الناس', 'من قلوب الأبرار', 'من قدّام الله', 'من كلام الشريعة'],
        correct: 'من قدّام الله',
        verse: 'مِنْ قُدَّامِكَ يَخْرُجُ قَضَائِي. عَيْنَاكَ تَنْظُرَانِ الْمُسْتَقِيمَاتِ. (مزمور 17: 2)'
      },
      {
        text: () => 'بماذا يُجَرَّب القلب حسب المزمور؟',
        options: ['بالصوم', 'بالنار', 'ليلاً', 'بالكلام'],
        correct: 'ليلاً',
        verse: 'جَرَّبْتَ قَلْبِي. تَعَهَّدْتَهُ لَيْلاً. (مزمور 17: 3)'
      },
      {
        text: () => 'من قتل جليات الجبار؟',
        options: ['شاول', 'داود', 'يوناثان', 'جدعون'],
        correct: 'داود',
        verse: 'فقال داود للفلسطيني: أنت تأتي إلي بسيف ورمح، أما أنا فآتي إليك باسم رب الجنود. (1 صموئيل 17: 45)'
      },
      {
        text: () => 'بماذا تحفّظ داود من طرق المعتنف؟',
        options: ['بالصوم', 'بصوت الله', 'بكلام شفتي الله', 'بناموس موسى'],
        correct: 'بكلام شفتي الله',
        verse: 'فَبِكَلاَمِ شَفَتَيْكَ أَنَا تَحَفَّظْتُ مِنْ طُرُقِ الْمُعْتَنِفِ. (مزمور 17: 4)'
      },
      {
        text: () => 'كيف يحفظ الله الإنسان حسب المزمور؟',
        options: ['مثل الصخر', 'مثل السور', 'مثل حدقة العين', 'مثل البرق'],
        correct: 'مثل حدقة العين',
        verse: 'احْفَظْنِي مِثْلَ حَدَقَةِ الْعَيْنِ. (مزمور 17: 8)'
      },
      {
        text: () => 'كيف يصف المزمور الأعداء؟',
        options: ['لطفاء', 'مملوئين كبرياء', 'مسالمين', 'جائعين'],
        correct: 'مملوئين كبرياء',
        verse: 'قَلْبَهُمُ السَّمِينَ قَدْ أَغْلَقُوا. بِأَفْوَاهِهِمْ قَدْ تَكَلَّمُوا بِالْكِبْرِيَاءِ. (مزمور 17: 10)'
      },
      {
        text: () => 'بمن شبّه داود أعداءه المفترسين؟',
        options: ['الذئاب', 'الأسود', 'الثعالب', 'النسور'],
        correct: 'الأسود',
        verse: 'مَثَلُهُ مَثَلُ الأَسَدِ الْقَرِمِ إِلَى الافْتِرَاسِ. (مزمور 17: 12)'
      },
      {
        text: () => 'ما الذي طلب داود من الله أن يفعله تجاه الأعداء؟',
        options: ['يباركهم', 'يصارعهم', 'يصمت عنهم', 'يرسل ملائكته عليهم'],
        correct: 'يصارعهم',
        verse: 'قُمْ يَا رَبُّ. تَقَدَّمْهُ. اِصْرَعْهُ. (مزمور 17: 13)'
      },
      {
        text: () => 'ما هو نصيب أهل الدنيا بحسب داود؟',
        options: ['في السماء', 'في المال فقط', 'في حياتهم', 'في الموت'],
        correct: 'في حياتهم',
        verse: 'مِنْ أَهْلِ الدُّنْيَا. نَصِيبُهُمْ فِي حَيَاتِهِمْ. (مزمور 17: 14)'
      },
      {
        text: () => 'متى يشبع داود برؤية وجه الرب؟',
        options: ['عند الصوم', 'في الضيق', 'إذا استيقظ', 'عند النوم'],
        correct: 'إذا استيقظ',
        verse: 'أَشْبَعُ إِذَا اسْتَيْقَظْتُ بِشَبَهِكَ. (مزمور 17: 15)'
      },
      {
        text: () => 'ماذا طلب داود من الله أن يصغي إليه؟',
        options: ['إلى صمته', 'إلى شكاواه', 'إلى صلاته', 'إلى ضحكه'],
        correct: 'إلى صلاته',
        verse: 'أَصْغِ إِلَى صَلاَتِي مِنْ شَفَتَيْنِ بِلاَ غِشٍّ. (مزمور 17: 1)'
      },
      {
        text: () => 'ما الذي تمسكت به خطوات داود؟',
        options: ['بالعادات', 'بتعاليم الكهنة', 'بآثار الرب', 'بالهيكل'],
        correct: 'بآثار الرب',
        verse: 'تَمَسَّكَتْ خُطُوَاتِي بِآثَارِكَ. (مزمور 17: 5)'
      },
      {
        text: () => 'كيف يصف داود نظرة الأعداء إليه؟',
        options: ['عابرة', 'مليئة بالخوف', 'يريدون زلّته', 'مشجعة'],
        correct: 'يريدون زلّته',
        verse: 'نَصَبُوا أَعْيُنَهُمْ لِيُزْلِقُونَا إِلَى الأَرْضِ. (مزمور 17: 11)'
      },
      {
        text: () => 'ما الذي يملأ به الرب بطون أهل الدنيا؟',
        options: ['شهوات', 'ذخائر', 'نار', 'خمر'],
        correct: 'ذخائر',
        verse: 'بِذَخَائِرِكَ تَمْلأُ بُطُونَهُمْ. (مزمور 17: 14)'
      },
      {
        text: () => 'كيف يميز الله مراحمه للمتكلين عليه؟',
        options: ['بعصا تأديب', 'بسيف', 'بيمينه', 'بالصوم'],
        correct: 'بيمينه',
        verse: 'مَيِّزْ مَرَاحِمَكَ، يَا مُخَلِّصَ الْمُتَّكِلِينَ عَلَيْكَ، بِيَمِينِكَ. (مزمور 17: 7)'
      },
      {
        text: () => 'ماذا لا يوجد في قلب داود حين فتشه الله؟',
        options: ['حب المال', 'الغش', 'ذموم', 'الخوف'],
        correct: 'ذموم',
        verse: 'مَحَّصْتَنِي. لاَ تَجِدُ فِيَّ ذُمُومًا. (مزمور 17: 3)'
      },
      {
        text: () => 'ماذا لا يتعدّى فم داود؟',
        options: ['كلام البشر', 'حدود البر', 'ناموس موسى', 'لا يتعدى فمه'],
        correct: 'لا يتعدى فمه',
        verse: 'لاَ تَجِدُ فِيَّ ذُمُومًا. لاَ يَتَعَدَّى فَمِي. (مزمور 17: 3)'
      },
      {
        text: () => 'ماذا فعل الأشرار بقلبهم؟',
        options: ['فتحوه', 'قسّوه', 'أغلقوه', 'تجاهلوه'],
        correct: 'أغلقوه',
        verse: 'قَلْبَهُمُ السَّمِينَ قَدْ أَغْلَقُوا. (مزمور 17: 10)'
      },
      {
        text: () => 'إلى من نصّب الأشرار أعينهم؟',
        options: ['إلى السماء', 'إلى الأرض', 'ليزلقوا الأبرار', 'على أنفسهم'],
        correct: 'ليزلقوا الأبرار',
        verse: 'نَصَبُوا أَعْيُنَهُمْ لِيُزْلِقُونَا إِلَى الأَرْضِ. (مزمور 17: 11)'
      },
      {
        text: () => 'لمن يترك أهل الدنيا فضالتهم؟',
        options: ['للفقراء', 'للهيكل', 'لأطفالهم', 'للغرباء'],
        correct: 'لأطفالهم',
        verse: 'يَشْبَعُونَ أَوْلاَدًا وَيَتْرُكُونَ فُضَالَتَهُمْ لأَطْفَالِهِمْ. (مزمور 17: 14)'
      }
    ];

    function showQuestion() {
      const container = document.getElementById('question-container');
      container.innerHTML = '';
     
      if (currentQuestion >= questions.length) {
        finishGame();
        return;
      }
     
      const question = questions[currentQuestion];
      const qDiv = document.createElement('div');
      qDiv.className = 'question';
      qDiv.innerHTML = `
        <h2>سؤال ${currentQuestion + 1}/${questions.length}: ${question.text()}</h2>
        <div class="timer-container">
          الوقت المتبقي: <span id="timer" class="timer">15</span> ثانية
        </div>
      `;

      const answersDiv = document.createElement('div');
      answersDiv.className = 'answers';

      question.options.forEach(opt => {
        const btn = document.createElement('button');
        btn.textContent = opt;
        btn.onclick = () => {
          clearInterval(timer);
          checkAnswer(opt, question.correct, question.text());
        };
        answersDiv.appendChild(btn);
      });

      qDiv.appendChild(answersDiv);
     
      if (question.verse) {
        const verseDiv = document.createElement('div');
        verseDiv.className = 'bible-verse';
        verseDiv.textContent = question.verse;
        qDiv.appendChild(verseDiv);
      }
     
      container.appendChild(qDiv);
      startTimer();
    }

    function checkAnswer(selected, correct, questionText) {
      if (selected !== correct) {
        wrongAnswers.push({
          question: questionText,
          yourAnswer: selected,
          correctAnswer: correct
        });
      } else {
        score++;
      }
      currentQuestion++;
      showQuestion();
    }

    function finishGame() {
      clearInterval(timer);
      document.getElementById('question-container').classList.add('hidden');
      const result = document.getElementById('result');
      result.classList.remove('hidden');
     
      savePlayerResult(playerName, score);
     
      if (score === questions.length) {
        const winSound = document.getElementById('win-sound');
        winSound.play().catch(e => console.log('تعذر تشغيل الصوت:', e));
       
        result.innerHTML = `
          <h2>مبروك يا ${playerName}! كسبت بدرجة كاملة (20/20) ✝️</h2>
          <p>معرفتك العظيمة بالكتاب المقدس تفرح القلب!</p>
          <div class="bible-verse">كل الكتاب هو موحى به من الله ونافع للتعليم (2 تيموثاوس 3: 16)</div>
          ${generateWrongAnswersSection()}
          <button onclick="resetGame()" style="background-color: #4cc9f0; color: #16213e; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; margin-top: 20px;">
            العودة للصفحة الرئيسية
          </button>
        `;
      } else {
        result.innerHTML = `
          <h2>${playerName}، درجتك النهائية: ${score} من ${questions.length}</h2>
          <p>هذه فرصتك لقراءة المزيد من الكتاب المقدس!</p>
          <div class="bible-verse">كلمتك مصباح لرجلي ونور لسبيلي (مزمور 119: 105)</div>
          ${generateWrongAnswersSection()}
          <button onclick="resetGame()" style="background-color: #4cc9f0; color: #16213e; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; margin-top: 20px;">
            العودة للصفحة الرئيسية
          </button>
        `;
      }
    }

    function generateWrongAnswersSection() {
      if (wrongAnswers.length === 0) return '';
      
      let wrongAnswersHTML = `
        <div class="wrong-answers-section">
          <div class="wrong-answers-title">الأجوبة التي تحتاج مراجعة:</div>
      `;
      
      wrongAnswers.forEach(answer => {
        const questionIndex = questions.findIndex(q => q.text() === answer.question) + 1;
        wrongAnswersHTML += `
          <div class="wrong-answer-item">
            <div class="question-text">السؤال ${questionIndex}: ${answer.question}</div>
            <div>إجابتك: <span class="your-answer">${answer.yourAnswer}</span></div>
            <div>الإجابة الصحيحة: <span class="correct-answer">${answer.correctAnswer}</span></div>
            ${questions.find(q => q.text() === answer.question).verse ? 
              `<div class="verse-hint">الآية: ${questions.find(q => q.text() === answer.question).verse}</div>` : ''}
          </div>
        `;
      });
      
      wrongAnswersHTML += `</div>`;
      return wrongAnswersHTML;
    }

    function resetGame() {
      clearInterval(timer);
      currentQuestion = 0;
      score = 0;
      wrongAnswers = [];
      document.getElementById('player-name').value = '';
      document.getElementById('start-screen').classList.remove('hidden');
      document.getElementById('main-leaderboard').classList.remove('hidden');
      document.getElementById('result').classList.add('hidden');
      document.getElementById('question-container').classList.add('hidden');
      fetchPlayers();
    }

    function savePlayerResult(name, points) {
      const existingPlayer = players.find(p => p.name.toLowerCase() === name.toLowerCase());
      
      if (!existingPlayer) {
        const newPlayer = {
          name: name,
          score: points,
          date: new Date().toISOString()
        };
        savePlayerToFirebase(newPlayer);
      }
    }

    function updatePlayerInFirebase(player) {
      const playerRef = window.firebaseRef(window.firebaseDatabase, `players/${player.id}`);
      window.firebaseUpdate(playerRef, {
        score: player.score,
        date: player.date
      });
    }

    function savePlayerToFirebase(player) {
      const playersRef = window.firebaseRef(window.firebaseDatabase, 'players');
      const newPlayerRef = window.firebasePush(playersRef);
      player.id = newPlayerRef.key;
      window.firebaseSet(newPlayerRef, player);
    }

    function updateLeaderboard() {
      const leaderboardContent = document.getElementById('leaderboard-content');
      
      while (leaderboardContent.children.length > 1) {
        leaderboardContent.removeChild(leaderboardContent.lastChild);
      }
     
      if (players.length === 0) {
        const noScores = document.createElement('div');
        noScores.className = 'no-scores';
        noScores.textContent = 'لا توجد نتائج بعد';
        leaderboardContent.appendChild(noScores);
        return;
      }
     
      players.slice(0, 10).forEach((player, index) => {
        const row = document.createElement('div');
        row.className = `leaderboard-row rank-${index + 1}`;
        
        const dateObj = new Date(player.date);
        const formattedDate = `${dateObj.getDate()}/${dateObj.getMonth() + 1}/${dateObj.getFullYear().toString().slice(-2)} ${dateObj.getHours()}:${dateObj.getMinutes().toString().padStart(2, '0')}`;
        
        row.innerHTML = `
          <span class="rank">${index + 1}</span>
          <span class="name" title="${player.name}">${player.name}</span>
          <span class="score">${player.score}</span>
          <span class="date">${formattedDate}</span>
        `;
        leaderboardContent.appendChild(row);
      });
    }
  </script>
</body>
</html>
